import{d as U,r as w,b as _,w as V,e as j,c as p,f as o,g as b,t as l,F as P,h as S,n as J,o as m,_ as Q}from"./index-DnrlOIil.js";const W="/docs/assets/plasterer-BHDip1JI.png",q="/docs/assets/figurine_maker-5tBvS9QH.png",K={class:"migration-map-container"},X={class:"map-wrapper"},Y=["id"],Z={class:"year-info-overlay"},ss={key:0,class:"destination-panel"},es={class:"panel-header"},os={class:"panel-content"},ts={class:"summary-stats"},as={class:"total-migrants"},ns={class:"number"},rs={class:"professions-list"},ls={class:"profession-items"},is=["onClick"],cs={class:"profession-name"},us={class:"migrant-count"},ds={key:1,class:"migrants-panel"},vs={class:"panel-header"},ps={class:"panel-content"},ms={class:"migrants-summary"},gs=["src","alt"],_s={class:"migrants-count"},hs={class:"number"},fs={class:"label"},ws={class:"migrants-list"},ys={class:"migrants-grid"},ks={class:"migrant-name"},Ms={class:"migrant-age"},Ls={key:0,class:"migrant-relationship"},bs=U({__name:"MigrationMapGeneric",props:{year:{},csvFileName:{}},setup(T){const h=T,u=w(null),y=w([]),k=w([]),i=w(null),r=w(""),I=_(()=>`map-${h.year}`),$=_(()=>h.year),M={lat:44,lng:10.5},C=async()=>{try{const s=(await(await fetch(`/src/assets/${h.csvFileName}`)).text()).split(`
`),d=s[0].split(","),a=[];for(let v=1;v<s.length;v++)if(s[v].trim()){const n=s[v].split(","),g={};d.forEach((c,f)=>{g[c.trim()]=n[f]?.trim()||""}),a.push(g)}k.value=a,console.log(`Loaded ${a.length} migration records for ${h.year}`)}catch(e){console.error(`Error loading migration data for ${h.year}:`,e)}},D=_(()=>{const e={};return k.value.forEach(t=>{const s=t.DESTINATION;if(!s||s==="not compiled")return;e[s]||(e[s]={name:s,total:0,professions:{},migrants:[],coordinates:{lat:parseFloat(t.LATITUDE)||0,lng:parseFloat(t.LONGITUDE)||0}}),e[s].total++,e[s].migrants.push(t);const d=t.PROFESSION||"Unknown";e[s].professions[d]=(e[s].professions[d]||0)+1}),e}),O=_(()=>i.value?Object.entries(i.value.professions).map(([e,t])=>({profession:e,count:Number(t)})).sort((e,t)=>t.count-e.count):[]),N=e=>{const t=e.toLowerCase();return t.includes("plasterer")||t.includes("gessaio")?W:t.includes("figurine maker")||t.includes("figurista")?q:null},E=_(()=>!i.value||!r.value?[]:i.value.migrants.filter(e=>e.PROFESSION===r.value)),F=_(()=>k.value.length),R=()=>{u.value&&u.value.remove(),u.value=window.L.map(I.value).setView([45,10],4),window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(u.value);const e=window.L.divIcon({className:"coreglia-marker",html:'<div class="marker-content">Coreglia<br>Antelminelli</div>',iconSize:[90,35],iconAnchor:[45,17.5]});window.L.marker([M.lat,M.lng],{icon:e}).addTo(u.value).bindPopup("Coreglia Antelminelli<br>Home of figurine merchants")},L=()=>{u.value&&u.value.closePopup(),y.value.forEach(a=>{u.value.removeLayer(a)}),y.value=[];const e=Object.values(D.value);if(e.length===0)return;const t=e.map(a=>a.total),s=Math.min(...t),d=Math.max(...t);e.forEach(a=>{if(a.coordinates.lat===0&&a.coordinates.lng===0)return;const v=(a.total-s)/(d-s),n=Math.max(8,8+v*20),g=Math.max(2,2+v*8),c=i.value&&i.value.name===a.name,f=window.L.divIcon({className:`destination-marker ${c?"selected":""}`,html:`<div class="dest-marker" style="width: ${c?n*2.5:n*2}px; height: ${c?n*2.5:n*2}px; font-size: ${Math.max(9,(c?n*2.5:n*2)*.4)}px;">${a.total}</div>`,iconSize:[c?n*2.5:n*2,c?n*2.5:n*2],iconAnchor:[c?n*1.25:n,c?n*1.25:n]}),A=window.L.marker([a.coordinates.lat,a.coordinates.lng],{icon:f}).addTo(u.value);A.on("click",()=>{i.value=a,r.value="",L()}),A.bindPopup(`
      <strong>${a.name}</strong><br>
      ${a.total} migrants
    `),y.value.push(A);const x=z([M.lat,M.lng],[a.coordinates.lat,a.coordinates.lng],g,c);x.addTo(u.value),y.value.push(x)})},z=(e,t,s,d=!1)=>{const a=(e[0]+t[0])/2,v=(e[1]+t[1])/2,n=.5,g=a+n,c=v+n,f=[e,[g,c],t];return window.L.polyline(f,{color:"#8b7355",weight:s,opacity:d?1:.3,smoothFactor:1})},B=e=>{r.value=r.value===e?"":e},G=()=>{i.value=null,r.value="",L()},H=()=>{r.value=""};return V(k,()=>{u.value&&L()},{deep:!0}),j(async()=>{await C(),R(),L()}),(e,t)=>(m(),p("div",K,[o("div",X,[o("div",{id:I.value,class:"map-container"},null,8,Y),o("div",Z,[o("h2",null,l($.value)+" Migration",1),o("p",null,l(F.value)+" migrants from Coreglia Antelminelli",1)])]),i.value?(m(),p("div",ss,[o("div",es,[o("h2",null,l(i.value.name),1),o("button",{class:"close-button",onClick:G},"×")]),o("div",os,[o("div",ts,[o("div",as,[o("span",ns,l(i.value.total),1),t[0]||(t[0]=o("span",{class:"label"},"total migrants",-1))])]),o("div",rs,[t[1]||(t[1]=o("h3",null,"Professions:",-1)),o("div",ls,[(m(!0),p(P,null,S(O.value,s=>(m(),p("div",{key:s.profession,class:J(["profession-item",{active:r.value===s.profession}]),onClick:d=>B(s.profession)},[o("span",cs,l(s.profession),1),o("span",us,l(s.count)+" "+l(s.count===1?"migrant":"migrants"),1)],10,is))),128))])])])])):b("",!0),r.value&&i.value?(m(),p("div",ds,[o("div",vs,[o("h2",null,l(r.value)+" in "+l(i.value.name),1),o("button",{class:"close-button",onClick:H},"×")]),o("div",ps,[o("div",ms,[N(r.value)?(m(),p("img",{key:0,src:N(r.value)||"",alt:r.value,class:"profession-icon-large"},null,8,gs)):b("",!0),o("div",_s,[o("span",hs,l(E.value.length),1),o("span",fs,l(r.value),1)])]),o("div",ws,[o("div",ys,[(m(!0),p(P,null,S(E.value,s=>(m(),p("div",{key:`${s.SURNAME_AND_NAME}-${s.AGE}`,class:"migrant-card"},[o("div",ks,l(s.SURNAME_AND_NAME),1),o("div",Ms,"Age: "+l(s.AGE),1),s.RELATIONSHIP?(m(),p("div",Ls,l(s.RELATIONSHIP),1)):b("",!0)]))),128))])])])])):b("",!0)]))}}),Is=Q(bs,[["__scopeId","data-v-5d4f1386"]]);export{Is as M};
